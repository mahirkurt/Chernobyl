// ============================================================================
// Carbon Design System - Main Stylesheet
// Refactored with proper structure, motion tokens, and accessibility
// ============================================================================

// Import abstracts (variables, mixins, motion tokens)
@use 'abstracts' as *;

// Import Carbon Design System
@use '@carbon/react';

// ============================================================================
// CSS Custom Properties
// ============================================================================

:root {
  // Font Families
  --cds-font-family-sans: 'IBM Plex Sans', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  --cds-font-family-serif: 'IBM Plex Serif', Georgia, serif;
  --cds-font-family-mono: 'IBM Plex Mono', Menlo, Consolas, monospace;

  // Carbon White Theme Colors
  --cds-background: #ffffff;
  --cds-background-active: rgba(141, 141, 141, 0.5);
  --cds-background-hover: rgba(141, 141, 141, 0.12);
  --cds-background-selected: rgba(141, 141, 141, 0.2);
  --cds-layer-01: #f4f4f4;
  --cds-layer-02: #e0e0e0;
  --cds-layer-accent-01: #e0e0e0;
  --cds-field-01: #f4f4f4;
  --cds-field-02: #ffffff;
  --cds-interactive: #0f62fe;
  --cds-border-subtle-01: #e0e0e0;
  --cds-border-strong-01: #8d8d8d;
  --cds-text-primary: #161616;
  --cds-text-secondary: #525252;
  --cds-text-on-color: #ffffff;
  --cds-link-primary: #0f62fe;
  --cds-link-primary-hover: #0043ce;
  --cds-link-visited: #8a3ffc;
  --cds-icon-primary: #161616;
  --cds-icon-secondary: #525252;
  --cds-support-error: #da1e28;
  --cds-support-success: #198038;
  --cds-support-warning: #f1c21b;
  --cds-support-info: #0043ce;
  --cds-focus: #0f62fe;
  --cds-highlight: #d0e2ff;
  --cds-button-disabled: #c6c6c6;
  
  // Skeleton colors
  --cds-skeleton-background: #e0e0e0;
  --cds-skeleton-element: #c6c6c6;
}

// Dark Theme (G100) Variables
[data-carbon-theme="g100"],
.cds--g100 {
  --cds-background: #161616;
  --cds-layer-01: #262626;
  --cds-layer-02: #393939;
  --cds-layer-accent-01: #393939;
  --cds-field-01: #262626;
  --cds-field-02: #393939;
  --cds-border-subtle-01: #393939;
  --cds-border-strong-01: #6f6f6f;
  --cds-text-primary: #f4f4f4;
  --cds-text-secondary: #c6c6c6;
  --cds-icon-primary: #f4f4f4;
  --cds-icon-secondary: #c6c6c6;
  --cds-skeleton-background: #353535;
  --cds-skeleton-element: #525252;
}

// G90 Theme
[data-carbon-theme="g90"],
.cds--g90 {
  --cds-background: #262626;
  --cds-layer-01: #393939;
  --cds-layer-02: #525252;
  --cds-layer-accent-01: #525252;
  --cds-field-01: #393939;
  --cds-field-02: #525252;
  --cds-border-subtle-01: #525252;
  --cds-border-strong-01: #8d8d8d;
  --cds-text-primary: #f4f4f4;
  --cds-text-secondary: #c6c6c6;
  --cds-icon-primary: #f4f4f4;
  --cds-icon-secondary: #c6c6c6;
}

// G10 Theme
[data-carbon-theme="g10"],
.cds--g10 {
  --cds-background: #f4f4f4;
  --cds-layer-01: #ffffff;
  --cds-layer-02: #e0e0e0;
}

// ============================================================================
// Base Styles
// ============================================================================

*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html,
body,
#root {
  height: 100%;
  font-family: var(--cds-font-family-sans);
}

body {
  background-color: var(--cds-background);
  color: var(--cds-text-primary);
  @include transition(background-color, $duration-moderate-02, $ease-standard-productive);
}

// ============================================================================
// Accessibility Styles
// ============================================================================

// Visually hidden - accessible to screen readers only
.visually-hidden {
  @include visually-hidden;
}

// Skip link - visible on focus for keyboard navigation
.skip-link {
  position: fixed;
  top: -100%;
  left: $spacing-05;
  z-index: $z-index-notification;
  padding: $spacing-03 $spacing-05;
  background-color: var(--cds-interactive);
  color: var(--cds-text-on-color);
  text-decoration: none;
  font-weight: $font-weight-semibold;
  border-radius: $border-radius-md;
  @include transition-fast(top);
  
  &:focus {
    top: $spacing-05;
    @include focus-outline;
  }
}

// Focus visible polyfill
:focus:not(:focus-visible) {
  outline: none;
}

:focus-visible {
  @include focus-outline;
}

// ============================================================================
// Scrollbar Styles
// ============================================================================

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--cds-layer-01);
}

::-webkit-scrollbar-thumb {
  background: var(--cds-border-strong-01);
  border-radius: $border-radius-md;
  @include transition-fast(background-color);

  &:hover {
    background: var(--cds-icon-secondary);
  }
}

// Firefox scrollbar
* {
  scrollbar-width: thin;
  scrollbar-color: var(--cds-border-strong-01) var(--cds-layer-01);
}

// ============================================================================
// Layout Styles
// ============================================================================

.app-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.main-content {
  flex: 1;
  display: flex;
  overflow: hidden;
  
  &:focus {
    outline: none;
  }
}

// ============================================================================
// Header Styles
// ============================================================================

.header-logo-link {
  display: flex;
  align-items: center;
  height: 100%;
  padding: 0 $spacing-05;
  text-decoration: none;
}

.header-logo {
  height: 24px;
  width: auto;
}

// ============================================================================
// Panel Base Styles
// ============================================================================

.panel {
  display: flex;
  flex-direction: column;
  background: var(--cds-layer-01);
  border-right: 1px solid var(--cds-border-subtle-01);

  &__header {
    padding: $spacing-05;
    border-bottom: 1px solid var(--cds-border-subtle-01);

    h3 {
      @include type-style('heading-compact-02');
      color: var(--cds-text-primary);
      display: flex;
      align-items: center;
    }

    p {
      @include type-style('helper-text-01');
      color: var(--cds-text-secondary);
      margin-top: $spacing-02;
    }
  }

  &__header-icon {
    margin-right: $spacing-03;
  }

  &__content {
    flex: 1;
    overflow: auto;
    padding: $spacing-05;
    @include custom-scrollbar;
  }
}

// ============================================================================
// Settings Sidebar
// ============================================================================

.settings-sidebar {
  width: 320px;
  background: var(--cds-layer-01);
  border-right: 1px solid var(--cds-border-subtle-01);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  @include custom-scrollbar;
  @include sidebar-transition;
}

.settings-section {
  padding: $spacing-05;
  border-bottom: 1px solid var(--cds-border-subtle-01);

  &__title {
    @include type-style('label-01');
    color: var(--cds-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: $spacing-04;
  }
}

.action-button {
  width: 100%;
  margin-bottom: $spacing-03;
  @include button-transition;
  
  &--primary {
    margin-bottom: $spacing-03;
  }
  
  &--secondary {
    margin-bottom: 0;
  }
}

.quick-access-tags {
  display: flex;
  flex-wrap: wrap;
  gap: $spacing-03;
}

// ============================================================================
// File Upload Area
// ============================================================================

.file-upload-area {
  border: 2px dashed var(--cds-border-strong-01);
  border-radius: $border-radius-lg;
  padding: $spacing-07;
  text-align: center;
  cursor: pointer;
  @include transition-multiple(
    border-color $duration-fast-02 $ease-standard-productive,
    background-color $duration-fast-02 $ease-standard-productive
  );

  &:hover,
  &:focus-within {
    border-color: var(--cds-interactive);
    background: var(--cds-layer-accent-01);
  }

  &:focus-visible {
    @include focus-outline;
  }

  &__icon {
    color: var(--cds-icon-secondary);
    margin-bottom: $spacing-04;
  }

  &__text {
    @include type-style('body-01');
    color: var(--cds-text-secondary);
  }

  &__link {
    color: var(--cds-link-primary);
    text-decoration: underline;
    cursor: pointer;
    @include link-transition;

    &:hover {
      color: var(--cds-link-primary-hover);
    }
  }
}

// ============================================================================
// Editor Panel
// ============================================================================

.editor-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 400px;
  @include animate-fade-in;
}

.markdown-editor {
  flex: 1;
  display: flex;
  flex-direction: column;

  &__textarea {
    width: 100%;
    height: 100% !important;
    min-height: 100%;
    
    textarea {
      font-family: var(--cds-font-family-mono) !important;
      font-size: 0.875rem !important;
      line-height: 1.6 !important;
      resize: none !important;
      @include custom-scrollbar;
    }
  }
}

// ============================================================================
// Preview Panel
// ============================================================================

.preview-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 400px;
  background: var(--cds-background);
  border-left: 1px solid var(--cds-border-subtle-01);
  border-right: none;
}

.pdf-preview {
  flex: 1;
  display: flex;
  flex-direction: column;

  &__container {
    flex: 1;
    padding: $spacing-07;
    overflow: auto;
    background: var(--cds-layer-accent-01);
    @include custom-scrollbar;
  }

  &__document {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    box-shadow: $shadow-raised-02;
    padding: $spacing-09;
    min-height: 1000px;
    @include animate-scale-in;
  }

  &__loading {
    @include flex-center;
    height: 300px;
  }

  &__content {
    font-family: var(--cds-font-family-sans);
    white-space: pre-wrap;
  }
}

// Preview content styles
.preview-h1 {
  @include type-style('heading-06');
  margin-bottom: $spacing-05;
  color: #161616;
}

.preview-h2 {
  @include type-style('heading-04');
  margin: $spacing-06 0 $spacing-04;
  color: #161616;
}

.preview-h3 {
  @include type-style('heading-03');
  margin: $spacing-05 0 $spacing-03;
  color: #161616;
}

.preview-code {
  background: #f4f4f4;
  padding: $spacing-01 $spacing-02;
  font-family: var(--cds-font-family-mono);
  font-size: 0.875rem;
  border-radius: $border-radius-sm;
}

.preview-blockquote {
  border-left: 3px solid #0f62fe;
  padding-left: $spacing-05;
  color: #525252;
  margin: $spacing-05 0;
  font-style: italic;
}

.preview-li {
  margin-left: $spacing-06;
  margin-bottom: $spacing-02;
}

// ============================================================================
// AI Advisor Panel
// ============================================================================

.advisor-panel {
  width: 360px;
  display: flex;
  flex-direction: column;
  background: var(--cds-layer-01);
  border-left: 1px solid var(--cds-border-subtle-01);
  @include animate-slide-in-right;
}

.chat-messages {
  flex: 1;
  overflow: auto;
  padding: $spacing-05;
  display: flex;
  flex-direction: column;
  gap: $spacing-04;
  @include custom-scrollbar;
}

.chat-message {
  display: flex;
  gap: $spacing-04;
  @include animate-slide-in-bottom;
  @include stagger-delay;

  &--user {
    flex-direction: row-reverse;

    .chat-message__content {
      background: var(--cds-interactive);
      color: var(--cds-text-on-color);
    }
  }

  &--ai {
    .chat-message__content {
      background: var(--cds-layer-02);
    }
  }

  &__avatar {
    width: 32px;
    height: 32px;
    border-radius: $border-radius-full;
    @include flex-center;
    flex-shrink: 0;

    &--user {
      background: var(--cds-interactive);
      color: white;
    }

    &--ai {
      background: var(--cds-support-info);
      color: white;
    }
  }

  &__content {
    padding: $spacing-04 $spacing-05;
    border-radius: $border-radius-lg;
    @include type-style('body-01');
    max-width: 85%;
  }
}

.chat-input {
  padding: $spacing-05;
  border-top: 1px solid var(--cds-border-subtle-01);
  display: flex;
  gap: $spacing-03;
  align-items: flex-end;

  &__textarea {
    flex: 1;
  }

  &__button {
    flex-shrink: 0;
  }
}

// ============================================================================
// Settings Modal
// ============================================================================

.settings-modal__section {
  display: flex;
  flex-direction: column;
  gap: $spacing-05;
  padding-top: $spacing-05;
}

// ============================================================================
// Notification Container
// ============================================================================

.notification-container {
  position: fixed;
  bottom: $spacing-05;
  right: $spacing-05;
  z-index: $z-index-notification;
  @include animate(notification-enter, $duration-moderate-02);
}

// ============================================================================
// Stat Tiles
// ============================================================================

.stat-tiles {
  @include grid-auto-fit(150px, $spacing-05);
  margin-bottom: $spacing-05;
}

.stat-tile {
  background: var(--cds-layer-01);
  border: 1px solid var(--cds-border-subtle-01);
  border-radius: $border-radius-md;
  padding: $spacing-05;
  @include card-hover;

  &__value {
    @include type-style('heading-05');
    color: var(--cds-interactive);
    line-height: 1;
  }

  &__label {
    @include type-style('label-01');
    color: var(--cds-text-secondary);
    margin-top: $spacing-03;
    text-transform: uppercase;
  }
}

// ============================================================================
// Responsive Styles
// ============================================================================

@include breakpoint-down(xlg) {
  .advisor-panel {
    display: none;
  }
}

@include breakpoint-down(lg) {
  .main-content {
    flex-direction: column;
  }

  .settings-sidebar {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid var(--cds-border-subtle-01);
    flex-direction: row;
    flex-wrap: wrap;
    overflow-x: auto;
  }

  .settings-section {
    flex: 1;
    min-width: 200px;
    border-bottom: none;
    border-right: 1px solid var(--cds-border-subtle-01);

    &:last-child {
      border-right: none;
    }
  }

  .editor-panel,
  .preview-panel {
    min-width: unset;
    flex: 1;
  }
}

@include breakpoint-down(md) {
  .settings-sidebar {
    flex-direction: column;
  }

  .settings-section {
    border-right: none;
    border-bottom: 1px solid var(--cds-border-subtle-01);
  }

  .pdf-preview__document {
    padding: $spacing-05;
  }
}

// ============================================================================
// Print Styles
// ============================================================================

@media print {
  .settings-sidebar,
  .advisor-panel,
  .notification-container,
  .skip-link {
    display: none !important;
  }

  .main-content {
    display: block;
  }

  .pdf-preview__document {
    box-shadow: none;
    padding: 0;
  }
}
