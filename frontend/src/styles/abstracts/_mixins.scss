// ============================================================================
// Carbon Design System - Global Mixins
// ============================================================================

@use 'variables' as *;
@use 'motion' as *;

// -----------------------------------------------------------------------------
// Breakpoint Mixins
// -----------------------------------------------------------------------------

// Mobile first breakpoint
@mixin breakpoint($bp) {
  @if map-has-key($breakpoints, $bp) {
    @media (min-width: #{map-get($breakpoints, $bp)}) {
      @content;
    }
  } @else {
    @media (min-width: $bp) {
      @content;
    }
  }
}

// Max-width breakpoint
@mixin breakpoint-down($bp) {
  @if map-has-key($breakpoints, $bp) {
    @media (max-width: #{map-get($breakpoints, $bp) - 1px}) {
      @content;
    }
  } @else {
    @media (max-width: calc(#{$bp} - 1px)) {
      @content;
    }
  }
}

// Between breakpoints
@mixin breakpoint-between($min, $max) {
  @media (min-width: #{map-get($breakpoints, $min)}) and (max-width: #{map-get($breakpoints, $max) - 1px}) {
    @content;
  }
}

// Shorthand mixins
@mixin sm { @include breakpoint(sm) { @content; } }
@mixin md { @include breakpoint(md) { @content; } }
@mixin lg { @include breakpoint(lg) { @content; } }
@mixin xlg { @include breakpoint(xlg) { @content; } }
@mixin max { @include breakpoint(max) { @content; } }

// -----------------------------------------------------------------------------
// Typography Mixins
// -----------------------------------------------------------------------------

@mixin type-style($style-name) {
  @if map-has-key($type-scale, $style-name) {
    $style: map-get($type-scale, $style-name);
    font-size: map-get($style, 'font-size');
    line-height: map-get($style, 'line-height');
    letter-spacing: map-get($style, 'letter-spacing');
    @if map-has-key($style, 'font-weight') {
      font-weight: map-get($style, 'font-weight');
    }
  }
}

@mixin font-sans {
  font-family: $font-family-sans;
}

@mixin font-serif {
  font-family: $font-family-serif;
}

@mixin font-mono {
  font-family: $font-family-mono;
}

// Text truncation
@mixin text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// Multi-line truncation
@mixin line-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// -----------------------------------------------------------------------------
// Focus Management Mixins
// -----------------------------------------------------------------------------

// Standard focus outline
@mixin focus-outline {
  outline: $focus-outline-width solid var(--cds-focus);
  outline-offset: $focus-outline-offset;
}

// Inset focus outline (for filled elements)
@mixin focus-outline-inset {
  outline: $focus-outline-width solid var(--cds-focus);
  outline-offset: $focus-inset-offset;
}

// Focus ring with transition
@mixin focus-ring {
  &:focus {
    @include focus-outline;
    @include focus-transition;
  }
  
  &:focus:not(:focus-visible) {
    outline: none;
  }
  
  &:focus-visible {
    @include focus-outline;
  }
}

// Remove default focus
@mixin focus-reset {
  outline: none;
  
  &:focus,
  &:focus-visible {
    outline: none;
  }
}

// -----------------------------------------------------------------------------
// Interactive State Mixins
// -----------------------------------------------------------------------------

// Button states
@mixin interactive-states($base-bg, $hover-bg, $active-bg, $disabled-bg: var(--cds-button-disabled)) {
  background-color: $base-bg;
  @include button-transition;
  
  &:hover:not(:disabled) {
    background-color: $hover-bg;
  }
  
  &:active:not(:disabled) {
    background-color: $active-bg;
  }
  
  &:disabled {
    background-color: $disabled-bg;
    cursor: not-allowed;
    opacity: 0.5;
  }
}

// Link states
@mixin link-states {
  color: var(--cds-link-primary);
  text-decoration: underline;
  @include link-transition;
  
  &:hover {
    color: var(--cds-link-primary-hover);
  }
  
  &:active {
    color: var(--cds-link-primary);
  }
  
  &:visited {
    color: var(--cds-link-visited);
  }
}

// Card hover effect
@mixin card-hover {
  @include card-transition;
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: $shadow-raised-02;
  }
  
  &:active {
    transform: translateY(0);
  }
}

// -----------------------------------------------------------------------------
// Layout Mixins
// -----------------------------------------------------------------------------

// Flexbox utilities
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

@mixin flex-column {
  display: flex;
  flex-direction: column;
}

// Full bleed (break out of container)
@mixin full-bleed {
  width: 100vw;
  margin-left: calc(50% - 50vw);
}

// Aspect ratio
@mixin aspect-ratio($width: 16, $height: 9) {
  aspect-ratio: #{$width} / #{$height};
}

// Container max-width
@mixin container($max-width: $breakpoint-max) {
  width: 100%;
  max-width: $max-width;
  margin-left: auto;
  margin-right: auto;
  padding-left: $spacing-05;
  padding-right: $spacing-05;
  
  @include breakpoint(md) {
    padding-left: $spacing-06;
    padding-right: $spacing-06;
  }
}

// -----------------------------------------------------------------------------
// Visual Mixins
// -----------------------------------------------------------------------------

// Skeleton loading
@mixin skeleton($width: 100%, $height: 1rem) {
  width: $width;
  height: $height;
  border-radius: $border-radius-sm;
  @include skeleton-animation;
}

// Visually hidden (screen readers only)
@mixin visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Reset button styles
@mixin button-reset {
  appearance: none;
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  font: inherit;
  color: inherit;
  cursor: pointer;
}

// Reset list styles
@mixin list-reset {
  list-style: none;
  margin: 0;
  padding: 0;
}

// Overlay backdrop
@mixin overlay-backdrop($opacity: 0.5) {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, $opacity);
  @include backdrop-transition;
}

// -----------------------------------------------------------------------------
// Grid Mixins
// -----------------------------------------------------------------------------

// CSS Grid auto-fit
@mixin grid-auto-fit($min-size: 250px, $gap: $spacing-05) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax($min-size, 1fr));
  gap: $gap;
}

// CSS Grid auto-fill
@mixin grid-auto-fill($min-size: 250px, $gap: $spacing-05) {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax($min-size, 1fr));
  gap: $gap;
}

// Carbon 16-column grid
@mixin carbon-grid {
  display: grid;
  grid-template-columns: repeat($grid-columns, 1fr);
  gap: $grid-gutter;
  
  @include breakpoint-down(md) {
    gap: $grid-gutter-narrow;
  }
}

// Grid span helper
@mixin grid-span($columns, $start: auto) {
  grid-column: $start / span $columns;
}

// -----------------------------------------------------------------------------
// Scrollbar Mixins
// -----------------------------------------------------------------------------

@mixin custom-scrollbar($width: 8px, $track: var(--cds-layer-01), $thumb: var(--cds-border-strong-01)) {
  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }
  
  &::-webkit-scrollbar-track {
    background: $track;
  }
  
  &::-webkit-scrollbar-thumb {
    background: $thumb;
    border-radius: $border-radius-md;
    
    &:hover {
      background: var(--cds-icon-secondary);
    }
  }
  
  // Firefox
  scrollbar-width: thin;
  scrollbar-color: $thumb $track;
}

@mixin hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
  
  &::-webkit-scrollbar {
    display: none;
  }
}
